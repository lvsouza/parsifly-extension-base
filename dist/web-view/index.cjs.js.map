{"version":3,"file":"index.cjs.js","sources":["../../src/web-view/index.ts"],"sourcesContent":["import * as ComLink from 'comlink';\n\n\ntype TStudioApi = {\n  /** Allows you to send a message to your extension host */\n  send: ComLink.Remote<(...data: any[]) => Promise<any>>;\n  /** Allows you to subscribe to receive a message from your extension host */\n  subscribeToMessage(fn: (...params: any[]) => void): () => void;\n}\n\n/**\n * Allows you to send and subscribe to receive message from your extension host\n */\nexport const acquireStudioApi = (): TStudioApi => {\n  if ((window as any).studioApi) return (window as any).studioApi as TStudioApi;\n\n  const listeners = new Set<((...params: any[]) => void)>();\n  const channel = new MessageChannel();\n\n\n  const apiAtIframe = {\n    async send(...data: any[]): Promise<any> {\n      listeners.forEach(listener => listener(...data));\n    }\n  };\n\n  ComLink.expose(apiAtIframe, channel.port1);\n  window.parent.postMessage({ type: 'connect' }, '*', [channel.port2]);\n\n\n  const apiStudio = ComLink.wrap<typeof apiAtIframe>(channel.port1);\n\n  (window as any).studioApi = {\n    send: apiStudio.send,\n    subscribeToMessage(fn: (...params: any[]) => void): () => void {\n      listeners.add(fn);\n      return () => listeners.delete(fn);\n    },\n  };\n\n  return (window as any).studioApi;\n}\n"],"names":["acquireStudioApi","listeners","channel","apiAtIframe","data","listener","ComLink.expose","apiStudio","ComLink.wrap","fn"],"mappings":"0HAaaA,EAAmB,IAAkB,CAC3C,GAAA,OAAe,UAAW,OAAQ,OAAe,UAEhD,MAAAC,MAAgB,IAChBC,EAAU,IAAI,eAGdC,EAAc,CAClB,MAAM,QAAQC,EAA2B,CACvCH,EAAU,QAAQI,GAAYA,EAAS,GAAGD,CAAI,CAAC,CAAA,CAEnD,EAEQE,SAAOH,EAAaD,EAAQ,KAAK,EAClC,OAAA,OAAO,YAAY,CAAE,KAAM,WAAa,IAAK,CAACA,EAAQ,KAAK,CAAC,EAGnE,MAAMK,EAAYC,EAAAA,KAAiCN,EAAQ,KAAK,EAE/D,cAAe,UAAY,CAC1B,KAAMK,EAAU,KAChB,mBAAmBE,EAA4C,CAC7D,OAAAR,EAAU,IAAIQ,CAAE,EACT,IAAMR,EAAU,OAAOQ,CAAE,CAAA,CAEpC,EAEQ,OAAe,SACzB"}