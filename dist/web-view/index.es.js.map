{"version":3,"file":"index.es.js","sources":["../../src/web-view/index.ts"],"sourcesContent":["import * as ComLink from 'comlink';\n\n\ntype TStudioApi = {\n  /** Allows you to send a message to your extension host */\n  send: ComLink.Remote<(...data: any[]) => Promise<any>>;\n  /** Allows you to subscribe to receive a message from your extension host */\n  subscribeToMessage(fn: (...params: any[]) => void): () => void;\n}\n\n/**\n * Allows you to send and subscribe to receive message from your extension host\n */\nexport const acquireStudioApi = (): TStudioApi => {\n  if ((window as any).studioApi) return (window as any).studioApi as TStudioApi;\n\n  const listeners = new Set<((...params: any[]) => void)>();\n  const channel = new MessageChannel();\n\n\n  const apiAtIframe = {\n    async send(...data: any[]): Promise<any> {\n      listeners.forEach(listener => listener(...data));\n    }\n  };\n\n  ComLink.expose(apiAtIframe, channel.port1);\n  window.parent.postMessage({ type: 'connect' }, '*', [channel.port2]);\n\n\n  const apiStudio = ComLink.wrap<typeof apiAtIframe>(channel.port1);\n\n  (window as any).studioApi = {\n    send: apiStudio.send,\n    subscribeToMessage(fn: (...params: any[]) => void): () => void {\n      listeners.add(fn);\n      return () => listeners.delete(fn);\n    },\n  };\n\n  return (window as any).studioApi;\n}\n"],"names":["acquireStudioApi","listeners","channel","ComLink.expose","data","listener","apiStudio","ComLink.wrap","fn"],"mappings":";AAaO,MAAMA,IAAmB,MAAkB;AAC3C,MAAA,OAAe,UAAW,QAAQ,OAAe;AAEhD,QAAAC,wBAAgB,IAAkC,GAClDC,IAAU,IAAI,eAAe;AAS3BC,EAAAA,EANY;AAAA,IAClB,MAAM,QAAQC,GAA2B;AACvC,MAAAH,EAAU,QAAQ,CAAAI,MAAYA,EAAS,GAAGD,CAAI,CAAC;AAAA,IAAA;AAAA,EAEnD,GAE4BF,EAAQ,KAAK,GAClC,OAAA,OAAO,YAAY,EAAE,MAAM,aAAa,KAAK,CAACA,EAAQ,KAAK,CAAC;AAGnE,QAAMI,IAAYC,EAAiCL,EAAQ,KAAK;AAE/D,gBAAe,YAAY;AAAA,IAC1B,MAAMI,EAAU;AAAA,IAChB,mBAAmBE,GAA4C;AAC7D,aAAAP,EAAU,IAAIO,CAAE,GACT,MAAMP,EAAU,OAAOO,CAAE;AAAA,IAAA;AAAA,EAEpC,GAEQ,OAAe;AACzB;"}